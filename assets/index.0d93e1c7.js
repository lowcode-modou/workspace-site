import{a as Te,u as Oe,R as Re}from"./main.1b495529.js";import{g as Ne}from"./router.0c64a742.js";import{r as d,l as j,aT as $,u as V,j as i,m,n as S,a as D,F as ke,S as Me,b as Be}from"./client.c2b1759f.js";import{i as L,s as se,w as je,a as ie,u as Z,b as _,r as $e,c as He,d as ze,e as q,f as Fe,g as he,h as Le,j as Ke,k as Ue,l as fe,m as me,n as ye,o as C,p as Ae,q as ee,t as ve,W as te,S as re,v as Y,x as Ge,y as we,z as _e,A as qe,B as Ye,C as Je,E as Xe,P as Qe,F as ae,G as U,D as Ve,H as Ze}from"./ReactRender.759423a2.js";import{p as K,l as F,B,j as et,A as H,T as tt,k as rt,S as oe,F as R,I as be,m as nt,n as z,o as k,f as st,h as ce,M as it,q as at}from"./AppFactoryContext.3a6f2cab.js";import"./EditOutlined.14b436d6.js";import{T as xe}from"./index.8d42cbc0.js";import{C as de}from"./index.515e14ce.js";import{R as Se,C as Ie,T as le}from"./SettingOutlined.5609f86c.js";function ot(t){return d.exports.useMemo(()=>t.hooks.dragSource(),[t])}function ct(t){return d.exports.useMemo(()=>t.hooks.dragPreview(),[t])}let A=!1,G=!1;class dt{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){L(!A,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return A=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{A=!1}}isDragging(){if(!this.sourceId)return!1;L(!G,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return G=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{G=!1}}subscribeToStateChange(e,r){return this.internalMonitor.subscribeToStateChange(e,r)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,r){return this.internalMonitor.isOverTarget(e,r)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}class lt{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,r=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return r&&this.disconnectDragSource(),this.handlerId?e?(r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),r):(this.lastConnectedDragSource=e,r):r}reconnectDragPreview(e=!1){const r=this.dragPreview,n=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(n&&this.disconnectDragPreview(),!!this.handlerId){if(!r){this.lastConnectedDragPreview=r;return}n&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=r,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,r,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!se(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!se(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=je({dragSource:(r,n)=>{this.clearDragSource(),this.dragSourceOptions=n||null,ie(r)?this.dragSourceRef=r:this.dragSourceNode=r,this.reconnectDragSource()},dragPreview:(r,n)=>{this.clearDragPreview(),this.dragPreviewOptions=n||null,ie(r)?this.dragPreviewRef=r:this.dragPreviewNode=r,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}function ut(t,e){const r=Z(),n=d.exports.useMemo(()=>new lt(r.getBackend()),[r]);return _(()=>(n.dragSourceOptions=t||null,n.reconnect(),()=>n.disconnectDragSource()),[n,t]),_(()=>(n.dragPreviewOptions=e||null,n.reconnect(),()=>n.disconnectDragPreview()),[n,e]),n}function gt(){const t=Z();return d.exports.useMemo(()=>new dt(t),[t])}class pt{beginDrag(){const e=this.spec,r=this.monitor;let n=null;return typeof e.item=="object"?n=e.item:typeof e.item=="function"?n=e.item(r):n={},n!=null?n:null}canDrag(){const e=this.spec,r=this.monitor;return typeof e.canDrag=="boolean"?e.canDrag:typeof e.canDrag=="function"?e.canDrag(r):!0}isDragging(e,r){const n=this.spec,s=this.monitor,{isDragging:o}=n;return o?o(s):r===e.getSourceId()}endDrag(){const e=this.spec,r=this.monitor,n=this.connector,{end:s}=e;s&&s(r.getItem(),r),n.reconnect()}constructor(e,r,n){this.spec=e,this.monitor=r,this.connector=n}}function ht(t,e,r){const n=d.exports.useMemo(()=>new pt(t,e,r),[e,r]);return d.exports.useEffect(()=>{n.spec=t},[t]),n}function ft(t){return d.exports.useMemo(()=>{const e=t.type;return L(e!=null,"spec.type must be defined"),e},[t])}function mt(t,e,r){const n=Z(),s=ht(t,e,r),o=ft(t);_(function(){if(o!=null){const[a,c]=$e(o,s,n);return e.receiveHandlerId(a),r.receiveHandlerId(a),c}},[n,e,r,s,o])}function ne(t,e){const r=He(t,e);L(!r.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const n=gt(),s=ut(r.options,r.previewOptions);return mt(r,n,s),[ze(r.collect,n,s),ot(s),ct(s)]}function J(t,e,r){r===void 0&&(r={});var n=q(e);Fe(function(){var s=he(r.target,window);if(!!(s!=null&&s.addEventListener)){var o=function(a){return n.current(a)};return s.addEventListener(t,o,{capture:r.capture,once:r.once,passive:r.passive}),function(){s.removeEventListener(t,o,{capture:r.capture})}}},[t,r.capture,r.once,r.passive],r.target)}var X=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yt={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pausebreak:19,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,delete:46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftwindowkey:91,rightwindowkey:92,selectkey:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222},Q={ctrl:function(e){return e.ctrlKey},shift:function(e){return e.shiftKey},alt:function(e){return e.altKey},meta:function(e){return e.metaKey}};function vt(t){var e=Object.keys(Q).reduce(function(r,n){return Q[n](t)?r+1:r},0);return[16,17,18,91,92].includes(t.keyCode)?e:e+1}function ue(t,e,r){var n,s;if(!t.key)return!1;if(fe(e))return t.keyCode===e;var o=e.split("."),l=0;try{for(var a=X(o),c=a.next();!c.done;c=a.next()){var u=c.value,f=Q[u],h=yt[u.toLowerCase()];(f&&f(t)||h&&h===t.keyCode)&&l++}}catch(g){n={error:g}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return r?l===o.length&&vt(t)===o.length:l===o.length}function wt(t,e){return Ke(t)?t:Ue(t)||fe(t)?function(r){return ue(r,t,e)}:Array.isArray(t)?function(r){return t.some(function(n){return ue(r,n,e)})}:t?function(){return!0}:function(){return!1}}var bt=["keydown"];function xt(t,e,r){var n=r||{},s=n.events,o=s===void 0?bt:s,l=n.target,a=n.exactMatch,c=a===void 0?!1:a,u=q(e),f=q(t);Le(function(){var h,g,y,p=he(l,window);if(!!p){var v=function(x){var I,N=wt(f.current,c);if(N(x))return(I=u.current)===null||I===void 0?void 0:I.call(u,x)};try{for(var w=X(o),b=w.next();!b.done;b=w.next()){var E=b.value;(y=p==null?void 0:p.addEventListener)===null||y===void 0||y.call(p,E,v)}}catch(P){h={error:P}}finally{try{b&&!b.done&&(g=w.return)&&g.call(w)}finally{if(h)throw h.error}}return function(){var P,x,I;try{for(var N=X(o),M=N.next();!M.done;M=N.next()){var We=M.value;(I=p==null?void 0:p.removeEventListener)===null||I===void 0||I.call(p,We,v)}}catch(Ee){P={error:Ee}}finally{try{M&&!M.done&&(x=N.return)&&x.call(N)}finally{if(P)throw P.error}}}}},[o],l)}const St=t=>{var l,a,c,u;const[e,r]=d.exports.useState({x:0,y:0,width:0,height:0}),[n,s]=d.exports.useState(!1);return J("mousemove",()=>{s(!1)},{target:document.body,capture:!0,passive:!0}),J("mousemove",f=>{const h=me(f.target,t.current);if(h){const g=h.getClientRects()[0];r({x:g.x,y:g.y,width:g.width,height:g.height}),s(!0)}else r({x:0,y:0,width:0,height:0}),s(!1)},{target:t,passive:!0}),{style:{width:`${(l=e.width)!=null?l:0}px`,height:`${(a=e.height)!=null?a:0}px`,left:`${(c=e.x)!=null?c:0}px`,top:`${(u=e.y)!=null?u:0}px`,display:n?"block":"none"}}},De=()=>{const t=j(ye);return{removeWidget:d.exports.useCallback((r,n=!0)=>{t(K(s=>{s.forEach(a=>{F.exports.isObject(a.slots)&&Object.keys(a.slots).forEach(c=>{const u=a.slots[c].findIndex(f=>f===r);u!==-1&&a.slots[c].splice(u,1)})});const o=[r],l=[s.find(a=>a.id===r)];for(;!F.exports.isEmpty(l);){const a=l.shift();F.exports.isObject(a.slots)&&Object.values(a.slots).forEach(c=>{c.forEach(u=>{o.push(u),l.push(s.find(f=>f.id===u))})})}o.forEach(a=>{const c=s.findIndex(u=>u.id===a);c!==-1&&s.splice(c,1)})}))},[t])}},It=()=>{const[t,e]=$(C),{removeWidget:r}=De();return xt("delete",()=>{t&&(r(t),e(""))}),null},Dt=({canvasRef:t})=>{const e=V(),{style:r}=St(t);return i("div",{className:Ct.wrapper,style:{...r,"--border-color":e.colorPrimary}})},Ct={wrapper:m({name:"1vyoufo",styles:"border:1px dashed var(--border-color);position:absolute;z-index:999999"})},Pt=t=>{const e=j(C);J("click",r=>{const n=me(r.target,t.current),s=Ae(n);e(s)},{target:t})},Wt=()=>{const t=S(C),e=S(ee(t)),r=S(ve),[{isDragging:n},s,o]=ne(()=>({type:e.widgetType,item:()=>({type:te.Move,widget:e}),collect:u=>({isDragging:u.isDragging()}),options:{dropEffect:"copy"}}),[e]);d.exports.useEffect(()=>{},[n]);const l=n?"0.4":"1",a=d.exports.useContext(re);d.exports.useEffect(()=>{const u=Y(t,a.document);u&&(u.style.opacity=l,o(u))},[l,o,t,a.document]);const c=V();return n||!r[t].parent?null:i("div",{style:{"--border-color":c.colorPrimary},className:T.box,children:D(B.Group,{className:T.button,size:"small",children:[i(B,{ref:s,className:`${T.button} ${T.dragButton}`,type:"primary",icon:i(et,{className:T.button})}),i(B,{className:T.button,type:"primary",children:"2"}),i(B,{className:T.button,type:"primary",children:"3"})]})})},T={button:m({name:"k1v6xs",styles:"height:16px!important;line-height:16px!important;font-size:12px!important;display:flex!important;justify-content:center!important;align-items:center!important"}),dragButton:m({name:"wa1o5r",styles:"cursor:move!important"}),box:m({name:"172hvwc",styles:"transform:translateY(-100%);margin-top:-2px;border-radius:3px;height:16px;display:flex;align-items:center;left:0;pointer-events:auto"})},Et=()=>{var w,b,E,P;const t=S(C),[e,r]=d.exports.useState({x:0,y:0,width:0,height:0}),n=S(ye),[s,o]=d.exports.useState(!1),[l,a]=d.exports.useState(0);d.exports.useEffect(()=>{setTimeout(()=>{a(x=>x+1)})},[n]);const c=d.exports.useContext(re);d.exports.useEffect(()=>{if(!t){o(!1);return}const x=Y(t,c.document);if(x){const I=x.getClientRects()[0];r({x:I.x,y:I.y,width:I.width,height:I.height}),o(!0)}else r({x:0,y:0,width:0,height:0}),o(!1)},[t,c.document,l]);const u={width:`${(w=e.width)!=null?w:0}px`,height:`${(b=e.height)!=null?b:0}px`,left:`${(E=e.x)!=null?E:0}px`,top:`${(P=e.y)!=null?P:0}px`,display:s?"block":"none"},f=S(ee(t)),[{isDragging:h},g,y]=ne(()=>({type:f.widgetType,item:()=>({type:te.Move,widget:f}),collect:x=>({isDragging:x.isDragging()}),options:{dropEffect:"copy"}}),[f]),p=h?"0.4":"1";d.exports.useEffect(()=>{const x=Y(t,c.document);x&&(x.style.opacity=p,y(x))},[p,y,t,c.document]);const v=V();return i("div",{ref:g,className:Ot.wrapper,style:{...u,"--border-color":v.colorPrimary},children:i(Wt,{})})},Tt=({canvasRef:t})=>(Pt(t),S(C)?i(Et,{}):null),Ot={wrapper:m({name:"1h9weiq",styles:"border:1px dashed var(--border-color);position:absolute;z-index:50"})},Rt=({canvasRef:t,style:e})=>D("div",{className:Nt.wrapper,style:e,children:[i(Dt,{canvasRef:t}),i(Tt,{canvasRef:t}),i(Ge,{})]}),Nt={wrapper:m({name:"zekarn",styles:"position:fixed;left:0;right:0;bottom:0;top:0;pointer-events:none;z-index:999999"})},kt=({children:t})=>{var f,h;const{widgets:e,rootWidgetId:r}=S(we),n=d.exports.useRef(null),[s,o]=d.exports.useState(!1);d.exports.useEffect(()=>{var g,y,p,v;!s||((y=(g=n.current)==null?void 0:g.contentWindow)==null||y.reactRenderHost.updateWidgets(e),(v=(p=n.current)==null?void 0:p.contentWindow)==null||v.reactRenderHost.updateRootWidgetId(r))},[e,r,s]);const l=d.exports.useRef(null),[a,c]=d.exports.useState({top:0,right:0,bottom:0,left:0}),u=d.exports.useCallback(()=>{setTimeout(()=>{var p;const g=n.current;l.current=(p=g.contentWindow)==null?void 0:p.document;const y=g.getClientRects()[0];c({top:y.top,right:y.right,bottom:y.bottom,left:y.left}),o(!0)})},[]);return D("div",{className:ge.wrapper,children:[d.exports.cloneElement(t,{ref:n,onLoad:u}),s&&i(ke,{children:D(re.Provider,{value:{document:(h=(f=n.current)==null?void 0:f.contentWindow)==null?void 0:h.document},children:[i(Rt,{canvasRef:l,style:a}),i(It,{})]})}),!s&&i("div",{className:ge.spinWrapper,children:i(Me,{size:"large"})})]})},ge={wrapper:m({name:"16o6e61",styles:"height:100vh;position:relative;padding:16px"}),spinWrapper:m({name:"1yfx3f8",styles:"height:100%;width:100%;display:flex;justify-content:center;align-items:center"})},Mt=()=>{const t=S(_e),[e,r]=$(C),n=[e||t.key],s=S(ve),{moveWidget:o}=qe(),l=d.exports.useContext(H),a=([h])=>{const g=h===t.key?"":h;r(g)},c=({dropNode:h,dropPosition:g,dragNode:y})=>{var w;const{widget:p}=h;if(!p)return!1;const v=l.widgetByType[p.widgetType].metadata;return g===-1?!!s[p.id].parent:g===0?!!((w=v.slots)!=null&&w.children):g===1?!!s[p.id].parent:!1},u=h=>{const g=h.node.pos.split("-"),y=h.dropPosition-Number(g[g.length-1]),p=h.dragNode.widget,v=h.node.widget;if(!p||!v)return;const w=s[v.id].parent,b="children";switch(y){case-1:w&&b&&o({sourceWidgetId:p.id,targetWidgetId:w.props.id,targetSlotName:b,targetPosition:w.props.slots[b].findIndex(E=>v.id===E)});break;case 1:w&&b&&o({sourceWidgetId:p.id,targetWidgetId:w.props.id,targetSlotName:b,targetPosition:w.props.slots[b].findIndex(E=>v.id===E)+1});break;case 0:o({sourceWidgetId:p.id,targetWidgetId:v.id,targetSlotName:b,targetPosition:0});break}console.log("dropPosition",y,h)},f=d.exports.useRef();return i("div",{className:Bt.treeWrapper,children:i(tt,{ref:f,showLine:!0,allowDrop:c,switcherIcon:i(rt,{}),selectedKeys:n,onSelect:a,defaultExpandAll:!0,draggable:{icon:!1},blockNode:!0,onDrop:u,treeData:[t]})})},Bt={treeWrapper:m({name:"7ggey5",styles:"padding:16px 8px"})},jt=()=>{const t=S(Ye),[e,r]=$(C),n=t[e],s=j(ee(e)),o=S(Je(e)),l=d.exports.useContext(H),a=d.exports.useMemo(()=>l.widgetByType[n.widgetType].metadata,[l.widgetByType,n.widgetType]),{removeWidget:c}=De(),u=Object.entries(a.jsonPropsSchema.properties.props.properties).filter(([,f])=>Reflect.has(f,oe)).map(([f,h])=>{const g=Reflect.get(h,oe),y=l.setterByType[g.type];return i(R.Item,{tooltip:g.description,label:g.label,children:i(y,{options:g,value:n.props[f],onChange:p=>{s(K(v=>{v.props[f]=p}))}})},f)});return D(R,{className:Ce.panel,labelWrap:!0,size:"small",children:[i(R.Item,{label:"\u7EC4\u4EF6\u7C7B\u578B",children:i(xe.Text,{children:a.widgetName})}),i(R.Item,{label:"\u7EC4\u4EF6\u540D\u79F0",children:i(be,{value:n.widgetName,onChange:f=>{s(K(h=>{h.widgetName=f.target.value}))},placeholder:"\u8BF7\u8F93\u5165\u7EC4\u4EF6\u540D\u79F0"})}),i(nt,{style:{margin:"8px 0"}}),u,!o&&i(R.Item,{wrapperCol:{span:24},children:i(B,{type:"primary",block:!0,danger:!0,onClick:()=>{c(e),r("")},children:"\u5220\u9664"})})]})},$t=()=>{const[t,e]=$(we);return i(R,{className:Ce.panel,labelWrap:!0,size:"small",children:i(R.Item,{label:"\u9875\u9762\u540D\u79F0",children:i(be,{onChange:r=>{e(K(n=>{n.name=r.target.value}))},value:t.name})})})},Ht=()=>{const t=S(C);return i("div",{style:{padding:"16px"},children:t?i(jt,{}):i($t,{})})},Ce={panel:m({name:"15fpo44",styles:"& .ant-form-item{margin-bottom:12px!important;&-control-input-content{justify-content:flex-end!important;.ant-input-number{flex:1!important;}}}"})},zt=({metadata:t})=>{const e=d.exports.useContext(H),[{isDragging:r},n,s]=ne(()=>({type:t.widgetType,item:()=>{const a=st.mrSchemeToDefaultJson(e.widgetByType[t.widgetType].metadata.jsonPropsSchema),c={...a,id:ce(),widgetName:`${a.widgetName}-${ce(4)}`};return{type:te.Add,widget:c}},end:(a,c)=>{const u=c.getDropResult();console.log("drag_end",a,u)},collect:a=>({isDragging:a.isDragging(),handlerId:a.getHandlerId()}),options:{dropEffect:"copy"}})),o=d.exports.useRef(null);d.exports.useEffect(()=>{s(o,{offsetX:0,offsetY:0})},[s]);const l=r?.3:1;return D(Ie,{className:O.widgetWrapper,style:{opacity:l},span:12,children:[D(de,{ref:o,size:"small",className:`${O.widget} ${O.previewWidget}`,style:{fontSize:"12px"},bodyStyle:{padding:"4px",width:"80px",backgroundColor:"rgba(0,0,0,.04)"},children:[i("div",{className:O.previewWidgetIcon,children:t.icon}),i("div",{children:t.widgetName})]}),D(de,{ref:n,size:"small",className:O.widget,bodyStyle:{padding:"8px 0",backgroundColor:"rgba(0,0,0,.04)"},children:[i("div",{className:O.widgetIcon,children:t.icon}),i("div",{children:t.widgetName})]})]})},Ft=()=>{const t=d.exports.useContext(H),e=d.exports.useMemo(()=>Object.values(t.widgetByType).reduce((r,n)=>(F.exports.isEmpty(r[n.group])?r[n.group]={name:z(n.group),widgets:[n]}:r[n.group].widgets.push(n),r),{[k.Container]:{name:z(k.Container),widgets:[]},[k.Input]:{name:z(k.Input),widgets:[]},[k.Button]:{name:z(k.Button),widgets:[]}}),[t.widgetByType]);return i("div",{children:Object.entries(e).map(([r,{name:n,widgets:s}])=>D("div",{className:O.widgetsPanel,children:[i(xe.Title,{level:5,children:n}),i(Se,{gutter:[8,8],children:s.map(({metadata:o})=>i(zt,{metadata:o},o.widgetType))})]},r))})},O={widgetWrapper:m({name:"1qesdsb",styles:"background-color:white"}),widget:m({name:"w77w2u",styles:"text-align:center;cursor:move;user-select:none;overflow:hidden"}),previewWidget:m({name:"1ms3iv6",styles:"position:absolute;z-index:0"}),previewWidgetIcon:m({name:"ytult0",styles:"font-size:14px;line-height:14px"}),widgetIcon:m({name:"h9twb6",styles:"font-size:24px;line-height:24px"}),widgetsPanel:m({name:"10rtstj",styles:"padding:16px"}),widgetGroup:m({name:"10rtstj",styles:"padding:16px"})},Lt=({children:t,page:e,onPageChange:r})=>{const n=j(C),[s,o]=d.exports.useState("");return i(Xe,{storeKey:Qe,listen:({updateItem:l})=>{e.id!==s&&(n(""),o(e.id)),ae.canUpdate&&l(U,e),ae.canUpdate=!0},read:l=>{if(l===U)return e},write:({diff:l})=>{for(const[a,c]of l)a===U&&r(c)},children:t})},Kt=({page:t,onPageChange:e,children:r})=>{const n=j(C);return i(Be,{children:i(Lt,{page:t,onPageChange:e,children:i(Ve,{backend:Ze,children:D("div",{className:W.wrapper,children:[i("div",{className:`${W.section} ${W.sectionLeft}`,children:i(le,{className:W.designerPanelTabs,type:"card",tabBarGutter:0,items:[{key:"CanvasDesignerOutlineTree",label:"\u5927\u7EB2\u6811",children:i(Mt,{})}]})}),i("div",{className:`${W.section} ${W.canvasWrapper}`,onClick:()=>n(""),children:i(kt,{children:r})}),i("div",{className:`${W.section} ${W.sectionRight}`,children:i(le,{className:W.designerPanelTabs,type:"card",tabBarGutter:0,items:[{key:"CanvasDesignerPropsPanel",label:"\u5C5E\u6027",children:i(Ht,{})},{key:"CanvasDesignerWidgetStencil",label:"\u7EC4\u4EF6\u5217\u8868",children:i(Ft,{})}]})})]})})})})},W={wrapper:m({name:"1l991oj",styles:"height:100%;display:flex;justify-content:space-between"}),section:m({name:"1t18v70",styles:"height:100%;background-color:white"}),sectionLeft:m({name:"1v1nmsf",styles:"width:220px"}),sectionRight:m({name:"16s5rj8",styles:"width:280px"}),canvasWrapper:m({name:"jtiazy",styles:"position:relative;flex:1;border:1px solid rgba(0,0,0,.05);border-top:none;border-bottom:0"}),designerPanelTabs:m({name:"j9szf6",styles:"&>.ant-tabs-nav{margin-bottom:0;}& .ant-tabs-nav-list{display:flex;width:100%;& .ant-tabs-tab{flex:1;border-radius:0!important;display:flex;justify-content:center;align-items:center;&.ant-tabs-tab-active{border-bottom-color:rgba(5, 5, 5, 0.13)!important;}}}"})},Pe=d.exports.forwardRef(({onLoad:t,src:e},r)=>i("iframe",{ref:r,className:Ut.iframe,src:e,onLoad:t}));Pe.displayName="SimulatorPC";const Ut={iframe:m({name:"17yvxh6",styles:"height:100%;width:100%;border:none;display:block"})},Zt=()=>{const{pageId:t,appId:e}=Te(),[r,n]=$(it.pageSelector(t)),s=Oe();return d.exports.useLayoutEffect(()=>{r||s(Ne(Re.APP,{appId:e}),{replace:!0})},[e,s,r]),i(Se,{justify:"center",align:"middle",className:pe.page,children:i(Ie,{span:24,className:pe.container,children:r&&i(H.Provider,{value:at,children:i(Kt,{page:r,onPageChange:n,children:i(Pe,{src:"/simulator/pc.html"})})})})})},pe={page:m({name:"13udsys",styles:"height:100%"}),container:m({name:"13udsys",styles:"height:100%"})};export{Zt as Page};
