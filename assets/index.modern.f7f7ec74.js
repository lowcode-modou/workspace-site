const c=Symbol("@ts-pattern/matcher"),y="@ts-pattern/anonymous-select-key",f=r=>Boolean(r&&typeof r=="object"),l=r=>r&&!!r[c],i=(r,e,n)=>{if(f(r)){if(l(r)){const t=r[c](),{matched:s,selections:a}=t.match(e);return s&&a&&Object.keys(a).forEach(h=>n(h,a[h])),s}if(!f(e))return!1;if(Array.isArray(r))return!!Array.isArray(e)&&r.length===e.length&&r.every((t,s)=>i(t,e[s],n));if(r instanceof Map)return e instanceof Map&&Array.from(r.keys()).every(t=>i(r.get(t),e.get(t),n));if(r instanceof Set){if(!(e instanceof Set))return!1;if(r.size===0)return e.size===0;if(r.size===1){const[t]=Array.from(r.values());return l(t)?Array.from(e.values()).every(s=>i(t,s,n)):e.has(t)}return Array.from(r.values()).every(t=>e.has(t))}return Object.keys(r).every(t=>{const s=r[t];return(t in e||l(a=s)&&a[c]().matcherType==="optional")&&i(s,e[t],n);var a})}return Object.is(e,r)},g=r=>new o(r,[]);class o{constructor(e,n){this.value=void 0,this.cases=void 0,this.value=e,this.cases=n}with(...e){const n=e[e.length-1],t=[e[0]],s=[];return e.length===3&&typeof e[1]=="function"?(t.push(e[0]),s.push(e[1])):e.length>2&&t.push(...e.slice(1,e.length-1)),new o(this.value,this.cases.concat([{match:a=>{let h={};const v=Boolean(t.some(u=>i(u,a,(m,p)=>{h[m]=p}))&&s.every(u=>u(a)));return{matched:v,value:v&&Object.keys(h).length?y in h?h[y]:h:a}},handler:n}]))}when(e,n){return new o(this.value,this.cases.concat([{match:t=>({matched:Boolean(e(t)),value:t}),handler:n}]))}otherwise(e){return new o(this.value,this.cases.concat([{match:n=>({matched:!0,value:n}),handler:e}])).run()}exhaustive(){return this.run()}run(){let e,n=this.value;for(let t=0;t<this.cases.length;t++){const s=this.cases[t],a=s.match(this.value);if(a.matched){n=a.value,e=s.handler;break}}if(!e){let t;try{t=JSON.stringify(this.value)}catch{t=this.value}throw new Error(`Pattern matching error: no pattern matches value ${t}`)}return e(n,this.value)}}export{g as K};
