import{a as Te,u as Re,R as Ne}from"./main.4b952cf6.js";import{g as Me}from"./router.10782de0.js";import{p as L,l as $,B,m as ke,A as j,n as Be,o as $e,S as se,F as R,T as fe,I as me,q as je,r as z,s as M,t as He,u as ie,v as Fe}from"./AppFactoryContext.c7852a25.js";import{r as l,l as H,aT as F,u as V,j as i,m,n as S,a as D,F as ze,S as Le,b as Ke,o as Ue}from"./client.fc98b091.js";import{i as K,s as ae,w as Ge,a as oe,u as Z,b as _,r as Ae,c as _e,d as qe,e as q,f as Ye,g as ye,h as Je,j as Xe,k as Qe,l as ve,m as we,n as be,o as C,p as Ve,q as ee,t as xe,W as te,S as re,v as Y,x as Ze,y as Se,z as et,A as tt,B as rt,C as nt,E as st,P as it,F as ce,G as U,D as at,H as ot}from"./ReactRender.a2e71deb.js";import{R as Ie,C as De,a8 as de}from"./SettingOutlined.e8c07042.js";import{C as le}from"./index.a6fc1918.js";import{M as ue}from"./index.e90dbef1.js";import"./index.modern.f7f7ec74.js";function ct(t){return l.exports.useMemo(()=>t.hooks.dragSource(),[t])}function dt(t){return l.exports.useMemo(()=>t.hooks.dragPreview(),[t])}let G=!1,A=!1;class lt{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){K(!G,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return G=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{G=!1}}isDragging(){if(!this.sourceId)return!1;K(!A,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return A=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{A=!1}}subscribeToStateChange(e,r){return this.internalMonitor.subscribeToStateChange(e,r)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,r){return this.internalMonitor.isOverTarget(e,r)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}class ut{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,r=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return r&&this.disconnectDragSource(),this.handlerId?e?(r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),r):(this.lastConnectedDragSource=e,r):r}reconnectDragPreview(e=!1){const r=this.dragPreview,n=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(n&&this.disconnectDragPreview(),!!this.handlerId){if(!r){this.lastConnectedDragPreview=r;return}n&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=r,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,r,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!ae(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!ae(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=Ge({dragSource:(r,n)=>{this.clearDragSource(),this.dragSourceOptions=n||null,oe(r)?this.dragSourceRef=r:this.dragSourceNode=r,this.reconnectDragSource()},dragPreview:(r,n)=>{this.clearDragPreview(),this.dragPreviewOptions=n||null,oe(r)?this.dragPreviewRef=r:this.dragPreviewNode=r,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}function gt(t,e){const r=Z(),n=l.exports.useMemo(()=>new ut(r.getBackend()),[r]);return _(()=>(n.dragSourceOptions=t||null,n.reconnect(),()=>n.disconnectDragSource()),[n,t]),_(()=>(n.dragPreviewOptions=e||null,n.reconnect(),()=>n.disconnectDragPreview()),[n,e]),n}function pt(){const t=Z();return l.exports.useMemo(()=>new lt(t),[t])}class ht{beginDrag(){const e=this.spec,r=this.monitor;let n=null;return typeof e.item=="object"?n=e.item:typeof e.item=="function"?n=e.item(r):n={},n!=null?n:null}canDrag(){const e=this.spec,r=this.monitor;return typeof e.canDrag=="boolean"?e.canDrag:typeof e.canDrag=="function"?e.canDrag(r):!0}isDragging(e,r){const n=this.spec,s=this.monitor,{isDragging:o}=n;return o?o(s):r===e.getSourceId()}endDrag(){const e=this.spec,r=this.monitor,n=this.connector,{end:s}=e;s&&s(r.getItem(),r),n.reconnect()}constructor(e,r,n){this.spec=e,this.monitor=r,this.connector=n}}function ft(t,e,r){const n=l.exports.useMemo(()=>new ht(t,e,r),[e,r]);return l.exports.useEffect(()=>{n.spec=t},[t]),n}function mt(t){return l.exports.useMemo(()=>{const e=t.type;return K(e!=null,"spec.type must be defined"),e},[t])}function yt(t,e,r){const n=Z(),s=ft(t,e,r),o=mt(t);_(function(){if(o!=null){const[a,d]=Ae(o,s,n);return e.receiveHandlerId(a),r.receiveHandlerId(a),d}},[n,e,r,s,o])}function ne(t,e){const r=_e(t,e);K(!r.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const n=pt(),s=gt(r.options,r.previewOptions);return yt(r,n,s),[qe(r.collect,n,s),ct(s),dt(s)]}function J(t,e,r){r===void 0&&(r={});var n=q(e);Ye(function(){var s=ye(r.target,window);if(!!(s!=null&&s.addEventListener)){var o=function(a){return n.current(a)};return s.addEventListener(t,o,{capture:r.capture,once:r.once,passive:r.passive}),function(){s.removeEventListener(t,o,{capture:r.capture})}}},[t,r.capture,r.once,r.passive],r.target)}var X=globalThis&&globalThis.__values||function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},vt={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pausebreak:19,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,delete:46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftwindowkey:91,rightwindowkey:92,selectkey:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222},Q={ctrl:function(e){return e.ctrlKey},shift:function(e){return e.shiftKey},alt:function(e){return e.altKey},meta:function(e){return e.metaKey}};function wt(t){var e=Object.keys(Q).reduce(function(r,n){return Q[n](t)?r+1:r},0);return[16,17,18,91,92].includes(t.keyCode)?e:e+1}function ge(t,e,r){var n,s;if(!t.key)return!1;if(ve(e))return t.keyCode===e;var o=e.split("."),c=0;try{for(var a=X(o),d=a.next();!d.done;d=a.next()){var u=d.value,f=Q[u],h=vt[u.toLowerCase()];(f&&f(t)||h&&h===t.keyCode)&&c++}}catch(g){n={error:g}}finally{try{d&&!d.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return r?c===o.length&&wt(t)===o.length:c===o.length}function bt(t,e){return Xe(t)?t:Qe(t)||ve(t)?function(r){return ge(r,t,e)}:Array.isArray(t)?function(r){return t.some(function(n){return ge(r,n,e)})}:t?function(){return!0}:function(){return!1}}var xt=["keydown"];function St(t,e,r){var n=r||{},s=n.events,o=s===void 0?xt:s,c=n.target,a=n.exactMatch,d=a===void 0?!1:a,u=q(e),f=q(t);Je(function(){var h,g,y,p=ye(c,window);if(!!p){var v=function(x){var I,N=bt(f.current,d);if(N(x))return(I=u.current)===null||I===void 0?void 0:I.call(u,x)};try{for(var w=X(o),b=w.next();!b.done;b=w.next()){var E=b.value;(y=p==null?void 0:p.addEventListener)===null||y===void 0||y.call(p,E,v)}}catch(P){h={error:P}}finally{try{b&&!b.done&&(g=w.return)&&g.call(w)}finally{if(h)throw h.error}}return function(){var P,x,I;try{for(var N=X(o),k=N.next();!k.done;k=N.next()){var Ee=k.value;(I=p==null?void 0:p.removeEventListener)===null||I===void 0||I.call(p,Ee,v)}}catch(Oe){P={error:Oe}}finally{try{k&&!k.done&&(x=N.return)&&x.call(N)}finally{if(P)throw P.error}}}}},[o],c)}const It=t=>{var c,a,d,u;const[e,r]=l.exports.useState({x:0,y:0,width:0,height:0}),[n,s]=l.exports.useState(!1);return J("mousemove",()=>{s(!1)},{target:document.body,capture:!0,passive:!0}),J("mousemove",f=>{const h=we(f.target,t.current);if(h){const g=h.getClientRects()[0];r({x:g.x,y:g.y,width:g.width,height:g.height}),s(!0)}else r({x:0,y:0,width:0,height:0}),s(!1)},{target:t,passive:!0}),{style:{width:`${(c=e.width)!=null?c:0}px`,height:`${(a=e.height)!=null?a:0}px`,left:`${(d=e.x)!=null?d:0}px`,top:`${(u=e.y)!=null?u:0}px`,display:n?"block":"none"}}},Ce=()=>{const t=H(be);return{removeWidget:l.exports.useCallback((r,n=!0)=>{t(L(s=>{s.forEach(a=>{$.exports.isObject(a.slots)&&Object.keys(a.slots).forEach(d=>{const u=a.slots[d].findIndex(f=>f===r);u!==-1&&a.slots[d].splice(u,1)})});const o=[r],c=[s.find(a=>a.id===r)];for(;!$.exports.isEmpty(c);){const a=c.shift();$.exports.isObject(a.slots)&&Object.values(a.slots).forEach(d=>{d.forEach(u=>{o.push(u),c.push(s.find(f=>f.id===u))})})}o.forEach(a=>{const d=s.findIndex(u=>u.id===a);d!==-1&&s.splice(d,1)})}))},[t])}},Dt=()=>{const[t,e]=F(C),{removeWidget:r}=Ce();return St("delete",()=>{t&&(r(t),e(""))}),null},Ct=({canvasRef:t})=>{const e=V(),{style:r}=It(t);return i("div",{className:Pt.wrapper,style:{...r,"--border-color":e.colorPrimary}})},Pt={wrapper:m({name:"1vyoufo",styles:"border:1px dashed var(--border-color);position:absolute;z-index:999999"})},Wt=t=>{const e=H(C);J("click",r=>{const n=we(r.target,t.current),s=Ve(n);e(s)},{target:t})},Et=()=>{const t=S(C),e=S(ee(t)),r=S(xe),[{isDragging:n},s,o]=ne(()=>({type:e.widgetType,item:()=>({type:te.Move,widget:e}),collect:u=>({isDragging:u.isDragging()}),options:{dropEffect:"copy"}}),[e]);l.exports.useEffect(()=>{},[n]);const c=n?"0.4":"1",a=l.exports.useContext(re);l.exports.useEffect(()=>{const u=Y(t,a.document);u&&(u.style.opacity=c,o(u))},[c,o,t,a.document]);const d=V();return n||!r[t].parent?null:i("div",{style:{"--border-color":d.colorPrimary},className:O.box,children:D(B.Group,{className:O.button,size:"small",children:[i(B,{ref:s,className:`${O.button} ${O.dragButton}`,type:"primary",icon:i(ke,{className:O.button})}),i(B,{className:O.button,type:"primary",children:"2"}),i(B,{className:O.button,type:"primary",children:"3"})]})})},O={button:m({name:"k1v6xs",styles:"height:16px!important;line-height:16px!important;font-size:12px!important;display:flex!important;justify-content:center!important;align-items:center!important"}),dragButton:m({name:"wa1o5r",styles:"cursor:move!important"}),box:m({name:"172hvwc",styles:"transform:translateY(-100%);margin-top:-2px;border-radius:3px;height:16px;display:flex;align-items:center;left:0;pointer-events:auto"})},Ot=()=>{var w,b,E,P;const t=S(C),[e,r]=l.exports.useState({x:0,y:0,width:0,height:0}),n=S(be),[s,o]=l.exports.useState(!1),[c,a]=l.exports.useState(0);l.exports.useEffect(()=>{setTimeout(()=>{a(x=>x+1)})},[n]);const d=l.exports.useContext(re);l.exports.useEffect(()=>{if(!t){o(!1);return}const x=Y(t,d.document);if(x){const I=x.getClientRects()[0];r({x:I.x,y:I.y,width:I.width,height:I.height}),o(!0)}else r({x:0,y:0,width:0,height:0}),o(!1)},[t,d.document,c]);const u={width:`${(w=e.width)!=null?w:0}px`,height:`${(b=e.height)!=null?b:0}px`,left:`${(E=e.x)!=null?E:0}px`,top:`${(P=e.y)!=null?P:0}px`,display:s?"block":"none"},f=S(ee(t)),[{isDragging:h},g,y]=ne(()=>({type:f.widgetType,item:()=>({type:te.Move,widget:f}),collect:x=>({isDragging:x.isDragging()}),options:{dropEffect:"copy"}}),[f]),p=h?"0.4":"1";l.exports.useEffect(()=>{const x=Y(t,d.document);x&&(x.style.opacity=p,y(x))},[p,y,t,d.document]);const v=V();return i("div",{ref:g,className:Rt.wrapper,style:{...u,"--border-color":v.colorPrimary},children:i(Et,{})})},Tt=({canvasRef:t})=>(Wt(t),S(C)?i(Ot,{}):null),Rt={wrapper:m({name:"1h9weiq",styles:"border:1px dashed var(--border-color);position:absolute;z-index:50"})},Nt=({canvasRef:t,style:e})=>D("div",{className:Mt.wrapper,style:e,children:[i(Ct,{canvasRef:t}),i(Tt,{canvasRef:t}),i(Ze,{})]}),Mt={wrapper:m({name:"1nt356n",styles:"position:fixed;left:0;right:0;bottom:0;top:0;pointer-events:none;z-index:999"})},kt=({children:t})=>{var f,h;const{widgets:e,rootWidgetId:r}=S(Se),n=l.exports.useRef(null),[s,o]=l.exports.useState(!1);l.exports.useEffect(()=>{var g,y,p,v;!s||((y=(g=n.current)==null?void 0:g.contentWindow)==null||y.reactRenderHost.updateWidgets(e),(v=(p=n.current)==null?void 0:p.contentWindow)==null||v.reactRenderHost.updateRootWidgetId(r))},[e,r,s]);const c=l.exports.useRef(null),[a,d]=l.exports.useState({top:0,right:0,bottom:0,left:0}),u=l.exports.useCallback(()=>{setTimeout(()=>{var p;const g=n.current;c.current=(p=g.contentWindow)==null?void 0:p.document;const y=g.getClientRects()[0];d({top:y.top,right:y.right,bottom:y.bottom,left:y.left}),o(!0)})},[]);return D("div",{className:pe.wrapper,children:[l.exports.cloneElement(t,{ref:n,onLoad:u}),s&&i(ze,{children:D(re.Provider,{value:{document:(h=(f=n.current)==null?void 0:f.contentWindow)==null?void 0:h.document},children:[i(Nt,{canvasRef:c,style:a}),i(Dt,{})]})}),!s&&i("div",{className:pe.spinWrapper,children:i(Le,{size:"large"})})]})},pe={wrapper:m({name:"16o6e61",styles:"height:100vh;position:relative;padding:16px"}),spinWrapper:m({name:"1yfx3f8",styles:"height:100%;width:100%;display:flex;justify-content:center;align-items:center"})},Bt=()=>{const t=S(et),[e,r]=F(C),n=[e||t.key],s=S(xe),{moveWidget:o}=tt(),c=l.exports.useContext(j),a=([h])=>{const g=h===t.key?"":h;r(g)},d=({dropNode:h,dropPosition:g,dragNode:y})=>{var w;const{widget:p}=h;if(!p)return!1;const v=c.widgetByType[p.widgetType].metadata;return g===-1?!!s[p.id].parent:g===0?!!((w=v.slots)!=null&&w.children):g===1?!!s[p.id].parent:!1},u=h=>{const g=h.node.pos.split("-"),y=h.dropPosition-Number(g[g.length-1]),p=h.dragNode.widget,v=h.node.widget;if(!p||!v)return;const w=s[v.id].parent,b="children";switch(y){case-1:w&&b&&o({sourceWidgetId:p.id,targetWidgetId:w.props.id,targetSlotName:b,targetPosition:w.props.slots[b].findIndex(E=>v.id===E)});break;case 1:w&&b&&o({sourceWidgetId:p.id,targetWidgetId:w.props.id,targetSlotName:b,targetPosition:w.props.slots[b].findIndex(E=>v.id===E)+1});break;case 0:o({sourceWidgetId:p.id,targetWidgetId:v.id,targetSlotName:b,targetPosition:0});break}console.log("dropPosition",y,h)},f=l.exports.useRef();return i("div",{className:$t.treeWrapper,children:i(Be,{ref:f,showLine:!0,allowDrop:d,switcherIcon:i($e,{}),selectedKeys:n,onSelect:a,defaultExpandAll:!0,draggable:{icon:!1},blockNode:!0,onDrop:u,treeData:[t]})})},$t={treeWrapper:m({name:"7ggey5",styles:"padding:16px 8px"})},jt=()=>{const t=S(rt),[e,r]=F(C),n=t[e],s=H(ee(e)),o=S(nt(e)),c=l.exports.useContext(j),a=l.exports.useMemo(()=>c.widgetByType[n.widgetType].metadata,[c.widgetByType,n.widgetType]),{removeWidget:d}=Ce(),u=Object.entries(a.jsonPropsSchema.properties.props.properties).filter(([,f])=>Reflect.has(f,se)).map(([f,h])=>{const g=Reflect.get(h,se),y=c.setterByType[g.type];return i(R.Item,{tooltip:g.description,label:g.label,children:i(y,{options:g,value:n.props[f],onChange:p=>{s(L(v=>{v.props[f]=p}))}})},f)});return D(R,{className:Pe.panel,labelWrap:!0,size:"small",children:[i(R.Item,{label:"\u7EC4\u4EF6\u7C7B\u578B",children:i(fe.Text,{children:a.widgetName})}),i(R.Item,{label:"\u7EC4\u4EF6\u540D\u79F0",children:i(me,{value:n.widgetName,onChange:f=>{s(L(h=>{h.widgetName=f.target.value}))},placeholder:"\u8BF7\u8F93\u5165\u7EC4\u4EF6\u540D\u79F0"})}),i(je,{style:{margin:"8px 0"}}),u,!o&&i(R.Item,{wrapperCol:{span:24},children:i(B,{type:"primary",block:!0,danger:!0,onClick:()=>{d(e),r("")},children:"\u5220\u9664"})})]})},Ht=()=>{const[t,e]=F(Se);return i(R,{className:Pe.panel,labelWrap:!0,size:"small",children:i(R.Item,{label:"\u9875\u9762\u540D\u79F0",children:i(me,{onChange:r=>{e(L(n=>{n.name=r.target.value}))},value:t.name})})})},Ft=()=>{const t=S(C);return i("div",{style:{padding:"16px"},children:t?i(jt,{}):i(Ht,{})})},Pe={panel:m({name:"15fpo44",styles:"& .ant-form-item{margin-bottom:12px!important;&-control-input-content{justify-content:flex-end!important;.ant-input-number{flex:1!important;}}}"})},zt=({metadata:t})=>{const e=l.exports.useContext(j),[{isDragging:r},n,s]=ne(()=>({type:t.widgetType,item:()=>{const a=He.mrSchemeToDefaultJson(e.widgetByType[t.widgetType].metadata.jsonPropsSchema),d={...a,id:ie(),widgetName:`${a.widgetName}-${ie(4)}`};return{type:te.Add,widget:d}},end:(a,d)=>{const u=d.getDropResult();console.log("drag_end",a,u)},collect:a=>({isDragging:a.isDragging(),handlerId:a.getHandlerId()}),options:{dropEffect:"copy"}})),o=l.exports.useRef(null);l.exports.useEffect(()=>{s(o,{offsetX:0,offsetY:0})},[s]);const c=r?.3:1;return D(De,{className:T.widgetWrapper,style:{opacity:c},span:12,children:[D(le,{ref:o,size:"small",className:`${T.widget} ${T.previewWidget}`,style:{fontSize:"12px"},bodyStyle:{padding:"4px",width:"80px",backgroundColor:"rgba(0,0,0,.04)"},children:[i("div",{className:T.previewWidgetIcon,children:t.icon}),i("div",{children:t.widgetName})]}),D(le,{ref:n,size:"small",className:T.widget,bodyStyle:{padding:"8px 0",backgroundColor:"rgba(0,0,0,.04)"},children:[i("div",{className:T.widgetIcon,children:t.icon}),i("div",{children:t.widgetName})]})]})},Lt=()=>{const t=l.exports.useContext(j),e=l.exports.useMemo(()=>Object.values(t.widgetByType).reduce((r,n)=>($.exports.isEmpty(r[n.group])?r[n.group]={name:z(n.group),widgets:[n]}:r[n.group].widgets.push(n),r),{[M.Container]:{name:z(M.Container),widgets:[]},[M.Input]:{name:z(M.Input),widgets:[]},[M.Button]:{name:z(M.Button),widgets:[]}}),[t.widgetByType]);return i("div",{children:Object.entries(e).map(([r,{name:n,widgets:s}])=>D("div",{className:T.widgetsPanel,children:[i(fe.Title,{level:5,children:n}),i(Ie,{gutter:[8,8],children:s.map(({metadata:o})=>i(zt,{metadata:o},o.widgetType))})]},r))})},T={widgetWrapper:m({name:"1qesdsb",styles:"background-color:white"}),widget:m({name:"w77w2u",styles:"text-align:center;cursor:move;user-select:none;overflow:hidden"}),previewWidget:m({name:"1ms3iv6",styles:"position:absolute;z-index:0"}),previewWidgetIcon:m({name:"ytult0",styles:"font-size:14px;line-height:14px"}),widgetIcon:m({name:"h9twb6",styles:"font-size:24px;line-height:24px"}),widgetsPanel:m({name:"10rtstj",styles:"padding:16px"}),widgetGroup:m({name:"10rtstj",styles:"padding:16px"})},Kt=({children:t,page:e,onPageChange:r})=>{const n=H(C),[s,o]=l.exports.useState("");return i(st,{storeKey:it,listen:({updateItem:c})=>{e.id!==s&&(n(""),o(e.id)),ce.canUpdate&&c(U,e),ce.canUpdate=!0},read:c=>{if(c===U)return e},write:({diff:c})=>{for(const[a,d]of c)a===U&&r(d)},children:t})},Ut=({page:t,onPageChange:e,children:r})=>{const n=H(C);return i(Ke,{children:i(Kt,{page:t,onPageChange:e,children:i(at,{backend:ot,children:D("div",{className:W.wrapper,children:[i("div",{className:`${W.section} ${W.sectionLeft}`,children:i(de,{className:W.designerPanelTabs,type:"card",tabBarGutter:0,items:[{key:"CanvasDesignerOutlineTree",label:"\u5927\u7EB2\u6811",children:i(Bt,{})}]})}),i("div",{className:`${W.section} ${W.canvasWrapper}`,onClick:()=>n(""),children:i(kt,{children:r})}),i("div",{className:`${W.section} ${W.sectionRight}`,children:i(de,{className:W.designerPanelTabs,type:"card",tabBarGutter:0,items:[{key:"CanvasDesignerPropsPanel",label:"\u5C5E\u6027",children:i(Ft,{})},{key:"CanvasDesignerWidgetStencil",label:"\u7EC4\u4EF6\u5217\u8868",children:i(Lt,{})}]})})]})})})})},W={wrapper:m({name:"1l991oj",styles:"height:100%;display:flex;justify-content:space-between"}),section:m({name:"1t18v70",styles:"height:100%;background-color:white"}),sectionLeft:m({name:"1v1nmsf",styles:"width:220px"}),sectionRight:m({name:"16s5rj8",styles:"width:280px"}),canvasWrapper:m({name:"jtiazy",styles:"position:relative;flex:1;border:1px solid rgba(0,0,0,.05);border-top:none;border-bottom:0"}),designerPanelTabs:m({name:"j9szf6",styles:"&>.ant-tabs-nav{margin-bottom:0;}& .ant-tabs-nav-list{display:flex;width:100%;& .ant-tabs-tab{flex:1;border-radius:0!important;display:flex;justify-content:center;align-items:center;&.ant-tabs-tab-active{border-bottom-color:rgba(5, 5, 5, 0.13)!important;}}}"})},We=l.exports.forwardRef(({onLoad:t,src:e},r)=>i("iframe",{ref:r,className:Gt.iframe,src:e,onLoad:t}));We.displayName="SimulatorPC";const Gt={iframe:m({name:"17yvxh6",styles:"height:100%;width:100%;border:none;display:block"})},er=()=>{const{pageId:t,appId:e}=Te(),[r,n]=F(ue.pageSelector(t)),s=Ue(({snapshot:c})=>()=>$.exports.head(c.getLoadable(ue.pagesSelector).contents),[]),o=Re();return l.exports.useLayoutEffect(()=>{const c=s();!r&&c&&o(Me(Ne.PAGE,{appId:e,pageId:c.id}),{replace:!0})},[e,s,o,r]),i(Ie,{justify:"center",align:"middle",className:he.page,children:i(De,{span:24,className:he.container,children:r&&i(j.Provider,{value:Fe,children:i(Ut,{page:r,onPageChange:n,children:i(We,{src:"/simulator/pc.html"})})})})})},he={page:m({name:"13udsys",styles:"height:100%"}),container:m({name:"13udsys",styles:"height:100%"})};export{er as Page};
